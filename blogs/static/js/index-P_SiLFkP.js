import{e,q as a,r as l,o as t,h as s,a as u,w as n,G as o,B as d,t as r,X as i,u as v,aC as f,c,aG as m,F as _,aH as p,P as g,Q as x,I as w,J as y,j as V,aI as I}from"./.pnpm-Bx6NWvas.js";import{A as b}from"./index-WixhmZAK.js";import{u as h}from"./useToast-BbU7hDGx.js";import{u as k}from"./user-H3FtX9wW.js";const U={key:"0"},A={key:0},N={key:0},j=e({__name:"index",setup(e){const{showToast:m}=h(),_=k(),p=a(!1),g=a(),x=a(),w=[e=>!!e||"新的昵称不能为空.",e=>e&&e.length>=2||"新的昵称不能少于2个字符.",e=>e&&e.length<=10||"起这么长名字？作者不同意"],y=async()=>{const{valid:e}=await x.value.validate();if(e.length)return;p.value=!0;const a=await b.Login.updateUserInfo_AJAX({userName:g.value});p.value=!1,a.data&&200==a.code?(x.value.reset(),x.value.resetValidation(),C(),m("昵称修改成功！","success")):m("昵称修改失败！","error")},V=a(),I=a(""),j=async e=>{const a=new FormData;a.append("file",e);const l=await b.uploadImg_AJAX({file:a});200==l.code?I.value=l.data:m("图片上传失败！","error")},J=async()=>{p.value=!0;const e=await b.Login.updateUserInfo_AJAX({avatar:I.value});p.value=!1,e.data&&200==e.code?(I.value="",V.value=null,C(),m("头像修改成功！","success")):m("头像修改失败！","error")},C=async()=>{const e=await b.Login.getUserInfo_AJAX();200==e.code&&await k().setUserInfo(e.data)},T=a(""),X=a(""),H=a(),L=a(""),M=[e=>!!e||"确认密码不能为空",e=>e===T.value||"两次输入密码不一致"],D=[e=>!!e||"密码不能为空",e=>/^(?=.*[a-z])(?=.*\d)[a-zA-Z\d]{6,}$/.test(e)||"密码应为字母和数字组成，且不能小于6位"],Y=[e=>!!e||"邮箱不能为空",e=>/.+@.+\..+/.test(e)||"请输入正确的邮箱"],G=async()=>{const{valid:e}=await H.value.validate();if(!e)return;200==(await b.Login.updateUserInfo_AJAX({password:X.value,email:L.value})).code?(H.value.reset(),H.value.resetValidation(),C(),m("密码修改成功！","success")):m("密码修改失败！","error")};return(e,a)=>{const m=l("v-img"),I=l("v-avatar"),b=l("v-card-text"),h=l("v-card"),k=l("v-col"),C=l("v-fade-transition"),S=l("v-row"),$=l("v-expansion-panel-title"),q=l("v-file-input"),z=l("v-spacer"),F=l("v-btn"),B=l("v-card-actions"),K=l("v-expansion-panel-text"),P=l("v-expansion-panel"),Q=l("v-text-field"),R=l("v-form"),Z=l("v-expansion-panels");return t(),s("div",null,[u(Z,{class:"max-w-5xl"},{default:n((()=>{var e,l,Z;return[u(h,{class:"w-full",subtitle:`绑定邮箱：${(null==(e=o(_).userInfo)?void 0:e.email)?null==(l=o(_).userInfo)?void 0:l.email:"暂未绑定邮箱"}`,title:`用户名：${null==(Z=o(_).userInfo)?void 0:Z.userName}`},{prepend:n((()=>[u(I,{class:"mr-3"},{default:n((()=>{var e;return[u(m,{alt:"John",src:null==(e=o(_).userInfo)?void 0:e.avatar},null,8,["src"])]})),_:1})])),default:n((()=>[u(b,{class:"my-3"},{default:n((()=>{var e;return[d("加入博客时间："+r(o(i)(null==(e=o(_).userInfo)?void 0:e.createdAt).format("YYYY-MM-DD HH:mm:ss")),1)]})),_:1})])),_:1},8,["subtitle","title"]),u(P,null,{default:n((()=>[u($,null,{default:n((({expanded:e})=>[u(S,{"no-gutters":""},{default:n((()=>[u(k,{class:"d-flex justify-start",cols:"4"},{default:n((()=>[d(" 修改头像 ")])),_:1}),u(k,{class:"text--secondary",cols:"8"},{default:n((()=>[u(C,{"leave-absolute":""},{default:n((()=>[e?(t(),s("span",U," 开始修改您的头像 🤩 ")):v("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:1}),u(K,null,{default:n((()=>[u(S,{"no-gutters":""},{default:n((()=>[u(q,{class:"max-w-2xl",modelValue:V.value,"onUpdate:modelValue":[a[0]||(a[0]=e=>V.value=e),j],accept:"image/jpg, image/jpeg, image/png",label:"上传一个您喜欢的图片"},null,8,["modelValue"])])),_:1}),u(B,null,{default:n((()=>[u(z),u(F,{color:"primary",variant:"text",onClick:J,loading:p.value},{default:n((()=>[d(" 提交！！！ ")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1}),u(P,null,{default:n((()=>[u($,null,{default:n((({expanded:e})=>[u(S,{"no-gutters":""},{default:n((()=>[u(k,{class:"d-flex justify-start",cols:"4"},{default:n((()=>[d(" 修改昵称 ")])),_:1}),u(k,{class:"text--secondary",cols:"8"},{default:n((()=>[u(C,{"leave-absolute":""},{default:n((()=>[e?(t(),s("span",A,"开始修改您的昵称 🤔")):v("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:1}),u(K,null,{default:n((()=>[u(S,{"no-gutters":""},{default:n((()=>[u(Q,{class:"max-w-2xl",rules:w,"hide-details":"auto",label:"新的昵称",ref_key:"userName_text_ref",ref:x,modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=e=>g.value=e)},null,8,["modelValue"])])),_:1}),u(B,null,{default:n((()=>[u(z),u(F,{color:"primary",variant:"text",onClick:y,loading:p.value},{default:n((()=>[d(" 提交！！！ ")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1}),u(P,null,{default:n((()=>[u($,null,{default:n((({expanded:e})=>[u(S,{"no-gutters":""},{default:n((()=>[u(k,{class:"d-flex justify-start",cols:"4"},{default:n((()=>[d(" 修改密码 ")])),_:1}),u(k,{class:"text--secondary",cols:"8"},{default:n((()=>[u(C,{"leave-absolute":""},{default:n((()=>{var a;return[e?(t(),s("span",N,r((null==(a=o(_).userInfo)?void 0:a.githubId)?"Tip：GitHub一键登录用户 需要初始化一个邮箱哦~ ":"开始修改你的密码 😎"),1)):v("",!0)]})),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:1}),u(K,null,{default:n((()=>[u(S,{"no-gutters":""},{default:n((()=>[u(R,{"fast-fail":"",onSubmit:a[5]||(a[5]=f((()=>{}),["prevent"])),class:"w-full max-w-2xl",ref_key:"password_ref",ref:H},{default:n((()=>{var e;return[(null==(e=o(_).userInfo)?void 0:e.email)?v("",!0):(t(),c(Q,{key:0,modelValue:L.value,"onUpdate:modelValue":a[2]||(a[2]=e=>L.value=e),rules:Y,label:"设置您的email"},null,8,["modelValue"])),u(Q,{modelValue:T.value,"onUpdate:modelValue":a[3]||(a[3]=e=>T.value=e),rules:D,label:"新的密码"},null,8,["modelValue"]),u(Q,{modelValue:X.value,"onUpdate:modelValue":a[4]||(a[4]=e=>X.value=e),rules:M,label:"再次输入新密码"},null,8,["modelValue"]),u(F,{class:"mt-2",type:"submit",block:"",loading:p.value,onClick:G},{default:n((()=>[d("提交")])),_:1},8,["loading"])]})),_:1},512)])),_:1})])),_:1})])),_:1})]})),_:1})])}}}),J={class:"flex items-center"},C={class:"ml-2"},T={class:"ml-3 text-gray-400 text-xs"},X={class:"mt-1 leading-6"},H={class:"flex items-center flex-row-reverse"},L={class:"mr-2"},M={class:"text-gray-400 text-xs"},D={class:"mt-1 leading-6"},Y={class:"flex items-center px-4 absolute bottom-0 left-0 w-full"},G={class:"flex items-center h-12"},S={class:"ml-2"},$=e({__name:"index",setup(e){const o=k(),i=m("https://www.shmilyyy.cn",{path:"/socket.io",withCredentials:!0,transports:["websocket"]}),v=[e=>!!e||"消息不能为空"],f=a([]),b=a(""),h=a(),U=async()=>{if((await h.value.validate()).length)return;const e={id:o.userInfo.id,avatar:o.userInfo.avatar,userName:o.userInfo.userName,time:(new Date).toLocaleString(),content:b.value,market:2};h.value.reset(),i.emit("sendMsg",e),setTimeout((()=>{N()}),50)},A=a([]),N=()=>{const e=document.querySelector(".overflow-auto");e&&(e.scrollTop=e.scrollHeight)};return _((()=>{i.emit("online",{id:o.userInfo.id,avatar:o.userInfo.avatar,userName:o.userInfo.userName}),i.on("launched",(e=>{e.id===o.userInfo.id&&(e.userName="你"),f.value.push({...e})})),i.on("getMsg",(e=>{e.id===o.userInfo.id&&(e.market=1),f.value.push({...e}),setTimeout((()=>{N()}),50)})),i.on("onlineUsers",(e=>{A.value=e}))})),p((()=>{i.emit("offline",{id:o.userInfo.id}),i.off("launched"),i.off("getMsg"),i.disconnect})),(e,a)=>{const o=l("v-avatar"),i=l("v-list-item"),m=l("v-list"),_=l("v-btn"),p=l("v-text-field"),k=l("v-card"),N=l("v-col"),j=l("v-badge"),$=l("v-row");return t(),s("div",null,[u($,null,{default:n((()=>[u(N,{cols:"12",md:"8"},{default:n((()=>[u(k,{style:{height:"81vh"},class:"relative"},{default:n((()=>[u(m,{lines:"two",class:"overflow-auto h-4/5"},{default:n((()=>[(t(!0),s(g,null,x(f.value,(e=>(t(),c(i,{key:e.id},{default:n((()=>[w(V("div",{class:"w-full text-center text-xs text-green-600"},r(e.userName)+" 加入了聊天室 ",513),[[y,3==e.market]]),w(V("div",null,[V("div",J,[u(o,{image:e.avatar,class:"self-start"},null,8,["image"]),V("div",C,[V("div",null,[d(r(e.userName)+" ",1),V("span",T,r(e.time),1)]),V("div",X,r(e.content),1)])])],512),[[y,2===e.market]]),w(V("div",null,[V("div",H,[u(o,{image:e.avatar,class:"self-start"},null,8,["image"]),V("div",L,[V("div",null,[V("span",M,r(e.time),1)]),V("div",D,r(e.content),1)])])],512),[[y,1===e.market]])])),_:2},1024)))),128))])),_:1}),V("div",Y,[u(p,{modelValue:b.value,"onUpdate:modelValue":a[1]||(a[1]=e=>b.value=e),ref_key:"iptRef",ref:h,onKeyup:I(U,["enter"]),rules:v},{append:n((()=>[u(_,{onClick:U,modelValue:b.value,"onUpdate:modelValue":a[0]||(a[0]=e=>b.value=e)},{default:n((()=>[d(" 发送 ")])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])])),_:1})])),_:1}),u(N,{cols:"12",md:"4"},{default:n((()=>[u(k,{class:"",title:"当前在线用户"},{default:n((()=>[u(m,null,{default:n((()=>[(t(!0),s(g,null,x(A.value,(e=>(t(),c(i,{key:e.id},{default:n((()=>[V("div",G,[u(j,{color:"success",dot:""},{default:n((()=>[u(o,{image:e.avatar},null,8,["image"])])),_:2},1024),V("div",S,r(e.userName),1)])])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})])),_:1})])}}}),q=e({__name:"index",setup(e){const s=a("one");return(e,a)=>{const o=l("v-tab"),r=l("v-tabs"),i=l("v-window-item"),v=l("v-window"),f=l("v-card");return t(),c(f,null,{default:n((()=>[u(r,{modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=e=>s.value=e)},{default:n((()=>[u(o,{value:"one"},{default:n((()=>[d("我的信息")])),_:1}),u(o,{value:"two"},{default:n((()=>[d("聊天室")])),_:1})])),_:1},8,["modelValue"]),u(v,{modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=e=>s.value=e),class:"p-5"},{default:n((()=>[u(i,{value:"one"},{default:n((()=>[u(j)])),_:1}),u(i,{value:"two"},{default:n((()=>[u($)])),_:1})])),_:1},8,["modelValue"])])),_:1})}}});export{q as default};
